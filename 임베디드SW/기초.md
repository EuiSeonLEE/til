# 📙 임베디드 SW 실행순서

임베디드 시스템의 SW 는 PC 가 이해할 수 있는 프로그램이 아닌, MCU 의 CPU 가 이해할 수 있는 프로그램의 형식으로 컴파일이 되어야한다. 이를 **크로스 컴파일**이라고 한다.

### ❄️ build vs compile

빌드란, 전처리 → 컴파일 → 어셈블 → 링크를 한후 나오는 ELF 파일을 HEX 파일로 CPU 가 이해할 수 있는 형태로 만들때까지의 과정이다. 컴파일은 이의 중간과정으로 소스 코드(c파일)를 컴파일해서 .o 파일 즉, object 파일로 만드는 과정이다. (전처리는 전처리기에서 따로 수행한다.)

### ❄️ 실행 순서

1. Embedded System의 전원을 ON 하게 되면 CPU 에 리셋신호를 보낸다.
2. CPU는 그때부터 동작을 실행하게 된다. 여기서 메모리를 0번지부터 실행한다.
3. Interrupt vector 를 설정한다.
4. Stack 포인터 초기 설정을 수행한다.
5. 데이터 포인터 초기 설정을 수행한다.
6. 그 후 main 함수가 호출된다.

Startup.s 코드가 main 함수 이전 먼저 실행이 된다. 여기에서 어셈블리어로 startup 코드가 작성된 이유는 C로 짜게 되면 스택 메모리 할당이 전제가 되어야하는데, 그런 부분이 설정이 안되었기 때문이다. 그래서 어셈블리어로 작성한다.

익셉션벡터, 인터럽트 디세이블(Disable), 피엘엘(PLL), 에스디램 초기화, 스택 영역 할당, 변수 초기화, 씨 언어의 메인 함수 진입 등을 startup.s 가 수행한다.

.data 섹션을 복사하는 것과 .bss 섹션의 초기화를 하고 main 함수를 호출한다. 

프로그램을 다운로드를 하고 나서 0번지 부터 다운로드된 프로그램을 실행시키는 과정이다!

### ❄️ 메모리 맵

### 💧 섹션

메모리 각 영역의 역할을 나타낸 것을 메모리 맵이라고 한다. 메모리 맵은  코드 영역과 데이터 영역의 두 영역으로 나뉜다. 코드 영역은 읽기 전용의 영역으로 ROM 공간을 가르킨다. 그리고 데이터 영역은 쓰고 읽을 수 있는 부분으로 RAM 공간을 가르킨다. 그리고 영역은 **섹션**이라고 불린다.

섹션

- text - 코드 영역이다. 기계어를 보관한다.
- data - 데이터 영역이다. 초기값을 갖는 변수를 보관한다.
- bss - 데이터 영역이다. 초기값을 갖지 않는 변수를 보관한다.